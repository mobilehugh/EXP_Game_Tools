= Project Plan: EXP__QT

A lightweight, living document to capture goals, scope, milestones, and decisions for this folder.


do not make file changes without my permission. I need to understand and learn why changes are being made first. 


== Purpose
a_persona_generator creates persona records, aka character sheets for a science fiction role playing game.
there are three modes of persona creation 

the user must choose from one of 4 persona types
. Anthro (most common)
. Alien (used in alien arena a lot)
. Robot
. AI (very rare)

there is also the ability to get random
. toys technological object yield system generating tech devices
. mutations generating psionic and physionic mutations


maintenance
. create pdfs for chosen personas
. 


fresh persona creation which is first level personas where the user can make some choices.
bespoke persona creation where the user gets to choose or randomize  every element of the persona
random persona creation where every element is randomized and the user has no interaction


== Scope
- In scope: TODO
- Out of scope: TODO

== Goals
- [ ] Clarify and adopt control-action constants (e.g., `QUIT`, `RESET`).
- [ ] Add a small rail API health-check script (config via env vars).
- [ ] Establish env management (`.env` ignores and `.env.example`).
- [ ] Review and apply safe efficiency tweaks in `please.py`.
- [ ] Fix any path or UX inconsistencies discovered during review.

== Milestones
- M1 — Foundations: TODO (e.g., environment, API keys, basic scripts)
- M2 — Core Features: TODO
- M3 — Polish + Docs: TODO

== Next Steps
- [ ] Prioritize goals (P0/P1/P2) and timeline.
- [ ] Decide approach for control constants (per-file vs shared enum).
- [ ] Note rail provider + endpoint; prep env var names.
- [ ] Implement first P0 task (see Tasks).

== Tasks
- [ ] Decide and add `QUIT`/`RESET` constants; refactor `a_persona_record.py` menu loop to use them and handle unknown selections + `KeyboardInterrupt`.
- [ ] `please.py`: keep toxic input rules as-is; optionally precompile patterns safely (with tests) without changing behavior.
- [ ] `please.py`: avoid mutating caller `choices` in `choose_this` (use a local copy); confirm no regressions.
- [ ] `please.py`: ensure `maintenance_workflow` has an explicit exit path (add `Exit` option or honor `Q`).
- [ ] `please.py`: consider converting recursive `input_this` confirmation to a loop to prevent deep recursion.
- [ ] `please.py`: review `show_me_your_dict` name handling for non-dicts; gate `'name' in dinkie` accordingly.
- [ ] `please.py`: simplify `get_table_result` by iterating keys without copying the dict; initialize `result = None` and check.
- [ ] `please.py`: confirm `Bin` path is `./Records/Bin/` everywhere.
- [ ] Add `.env` patterns to `.gitignore` and create `.env.example` (no secrets).
- [ ] Create `scripts/rail_health_check.py` reading `RAIL_URL` and `RAIL_KEY` (or provider-specific) and printing status + sample data.
- [ ] Document run instructions in `README.adoc` for the health check.
- [ ] Back navigation: Decide approach (sentinel vs exception) to centralize Back handling without adding it to every menu list.
- [ ] If sentinel: define `BACK` constant and add `B` hotkey handling in `choose_this`; adjust prompts to show `[B-back]`.
- [ ] If sentinel: add boundary checks to top-level menus (e.g., `maintenance_workflow`, `record_maintenance`) to `return` when `selection == BACK`.
- [ ] If exception: define `BackNavigation` and raise from `choose_this` on `B`; wrap menu boundaries in `try/except BackNavigation: return`.

== Technical Suggestions
- a_persona_record.py:
  - Define `QUIT` and `RESET` constants; lift `choices_function_map` to module scope; handle unknown selections; wrap interactive loop with `KeyboardInterrupt` handling.
- please.py:
  - Keep current toxic check; if optimizing, precompile regex safely and unit-test against common names (e.g., “Hugh”).
  - In `choose_this`, operate on a local copy of `choices` to avoid side effects; show `Exit`/sentinels consistently.
  - Replace recursive confirmation in `input_this` with a loop for clarity and stack safety.
  - Verify `collect_desired_record` uses `./Records/Bin/` and streamline “last line” reading if desired.
  - Consider ANSI clear fallback only if it doesn’t affect platforms; otherwise keep current `subprocess` call.
- Repo hygiene:
  - Add `.env` ignores; add `.env.example` with placeholders.
  - Add a simple health-check script for rail API connectivity to run when online.
 
=== Back Navigation (Centralized)
- Sentinel approach:
  - Define `BACK` constant (e.g., `BACK = "__BACK__"`) in `please.py`.
  - Update `choose_this` prompt to include `[B-back]` and return `BACK` when user enters `B`.
  - At menu boundaries (a few functions only), detect `selection == BACK` and `return` to go up one level.
- Exception approach:
  - Define `class BackNavigation(Exception): pass` in `please.py`.
  - In `choose_this`, on `B`, `raise BackNavigation()`.
  - Wrap menu boundary bodies in `try/except BackNavigation: return` so Back bubbles up automatically.
- Notes:
  - Back is navigation-only; it does not undo state. Rely on existing Yes/No confirmations for committing changes.
  - Keep `Q` (Quit) and `R` (Reset) behavior unchanged; this only adds a consistent “go up one level”.

== Risks & Assumptions
- Risks: TODO
- Assumptions: TODO

== Decision Log
- YYYY-MM-DD — Decision: Rationale
- YYYY-MM-DD — Decision: Rationale

== Notes
- Add links, references, and scratch notes here.

----
How to use:
- Check off items as you complete them.
- Keep this file small and high-signal; deeper detail can go into separate docs/scripts.
- If helpful, we can mirror the “Tasks” section into a CLI-tracked plan.
